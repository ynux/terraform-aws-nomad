---
# from https://gist.github.com/rbq/886587980894e98b23d0eee2a1d84933
# which follows https://docs.docker.com/install/linux/docker-ce/ubuntu/
- hosts: nomad_clients_docker
  become: true
  tasks:
  - name: set node_class in nomad config
/opt/nomad/config/default.hcl
    blockinfile: 
    register: nomad_class_configured
    notify: restart_supervisorctl 
  handlers:
    name: :	
- command: supervisorctl reread
  sudo: yes
- supervisorctl: name=program:process state=restarted config=/etc/supervisor/supervisord.conf
  sudo: yes
  - name: Add Docker GPG key
    apt_key: url=https://download.docker.com/linux/ubuntu/gpg

  - name: Install basic list of packages
    apt:
      name: ['apt-transport-https','ca-certificates','curl','gnupg2','software-properties-common']
      state: present
      update_cache: yes

  - name: Add Docker APT repository
    apt_repository:
      repo: deb [arch=amd64] https://download.docker.com/linux/{{ansible_distribution|lower}} {{ansible_distribution_release}} stable

  - name: Install Docker packages
    apt:
      name: ['docker-ce','docker-ce-cli','containerd.io']
      state: present

